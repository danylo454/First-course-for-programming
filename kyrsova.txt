#include<iostream>
#include<ctime>
#include<fstream>
#include<string>

using namespace std;

//Розв'язувані задачі: облік товарів. Реалізувати наступні сервіси:
//1)Заповнення бази даних
//2)Перегляд даних про всі товари
//3)Доповнення бази даних товаром
//4)Видалення товару із бази даних
//5)Редагування запису про певний товар
//6)Упорядкування по полях : назва товару, ціна товару
//7)Пошук : наприклад, фірма ХХ і все, що з нею зв'язане; магнітофони УУ
//8)Вибірка : товари певного типу за ціною від X до Y
//9)Обчислення : середня ціна на товари певного типу(наприклад, телевізори)// знайти всі телевізори додати їхню ціну і поділити на кількість
//10)Корекція : видалення зведень про вказані товари; 1)зміна ціни на товари вказаного типу(наприклад, телевізори фірми SONY на - 5 %)
//11)Табличний звіт : інформація про телевізори(марка, ціна, назва), впорядкування по полю “назва”
//Додаткові вимоги : перевірка на введення ціни товару(повинна бути більше 0 грн.).
//Для обробки даних скористатися динамічним масивом покажчиків на структури відповідного типу
void pr()
{
	cout << "\t\t\t*********    |Menu|    *********" << endl;
	cout << "\t________________________________________________________" << endl;
	cout << "\t1)Filling the database         || 1)Запонення бази данних " << endl;
	cout << "\t2)View data about all goods    || 2)Перегляд усього товару" << endl;
	cout << "\t3)Database additions           || 3)Доповнення бази" << endl;
	cout << "\t4)Product goods from the base  || 4)Видалення товару iз бази даних" << endl;
	cout << "\t5)Edit goods                   || 5)Редагування запису про певний товар" << endl;
	cout << "\t6)Sort by name or prise        || 6)Сортування по iменi чи прайсу" << endl;
	cout << "\t7)Search by firma all goods    || 7)Пошук товарiв по фiрмi " << endl;
	cout << "\t8)Enter goods by filter prise  || 8)Фiльтр товарiв певного типу за цiною вiд X до Y" << endl;
	cout << "\t9)Average goods price          || 9)Середня цiна товару"<< endl;
	cout << "\t10)Product correction          || 10)Корекцiя товару" << endl;
	cout << "\t11)Product information         || 11)Табличний звiт" << endl;
	cout << "\t________________________________________________________" << endl;
	cout << "\tEnter your options: ";
}
struct biz
{
	char name[20] = "none";
	char firma[20] = "none";
	int id = 0;
	int prise = 0;
};
void addbiz(biz& obj)
{
	int price = 0;
	cout << "\n___________________________________" << endl;
	cout << "\tInput info: " << endl;
	cout << "\tname: ";
	cin >> obj.name;
	cout << "\tfirma: ";
	cin >> obj.firma;
	cout << "\tprice: ";
	cin >> obj.prise;
	cout << "\tEnter id tovara: ";
	cin >> obj.id;
	cout << "\n===================================" << endl;
}
void print(biz& obj)
{
	cout << "" << endl;
	cout << "\tname: " << obj.name << endl;
	cout << "\tfirma: " << obj.firma << endl;
	cout << "\tprice: " << obj.prise << endl;
	cout << "\tId tovara: " << obj.id << endl;
	cout << "\n===================================" << endl;
}
void toLowerSTR(char* arr, char* convert)
{
	for (size_t i = 0; i < strlen(arr); i++)
	{
		convert[i] = tolower(arr[i]);// якщо велика то буде маленька нижній регістр повернення
	}
	convert[strlen(arr)] = '\0';
}
template <typename T>
int search(T* arr, int length, char* name, int id)
{
	char obname[20];
	for (size_t i = 0; i < length; i++)
	{
		toLowerSTR(arr[i].name, obname);
		toLowerSTR(name, name);
		if (strcmp(obname, name) == 0 && arr[i].id == id)
		{
			return i;
		}
	}
	return -1;
}
template <typename T>
int searchID(T* arr, int length, int id)
{
	for (size_t i = 0; i < length; i++)
	{
		if (arr[i].id == id)
		{
			return i;
		}
	}
	return -1;
}
template <typename T>
void delname(T*& arr, int& length, char* name, int id)
{
	int index = search(arr, length, name, id);
	if (index == -1 || length == 0) {
		cout << "\n===================================" << endl;
		cout << "\tNot found" << endl;
		cout << "\n===================================" << endl;
	}
	else
	{
		length--;
		T* mas = new T[length];
		for (size_t i = 0; i < length; i++)
		{
			if (i < index)
			{
				mas[i] = arr[i];
			}
			else
			{
				mas[i] = arr[i + 1];
			}
		}
		delete[] arr;
		arr = mas;
	}
}
template <typename T>
void sortName(T*& arr, int length)
{
	char firstname[20];
	char secondname[20];
	T temp;
	for (size_t j = 0; j < length - 1; j++)
	{
		for (size_t i = 0; i < length - 1 - j; i++)
		{
			toLowerSTR(arr[i].name, firstname);
			toLowerSTR(arr[i + 1].name, secondname);
			if (strcmp(firstname, secondname) == 1)
			{
				temp = arr[i];
				arr[i] = arr[i + 1];
				arr[i + 1] = temp;
			}
		}

	}
	for (size_t i = 0; i < length; i++)
	{
		print(arr[i]);
	}
}
template <typename T>
void sortPrise(T* arr, int length)
{
	for (size_t i = 0; i < length - 1; i++)
	{
		for (size_t j = 0; j < length - 1 - i; j++)
		{
			if (arr[j].prise > arr[j + 1].prise)
			{
				swap(arr[j].prise, arr[j + 1].prise);
			}
		}
	}
	for (size_t i = 0; i < length; i++)
	{
		print(arr[i]);
	}

}
template <typename T>
void updatetovar(T*& arr, int length)
{

	cout << "\n===================================" << endl;
	int viborid;
	cout << "\tEnter id tovara: ";
	cin >> viborid;
	int index = searchID(arr, length, viborid);
	if (index == -1)
	{
		cout << "\tid tovara not found " << endl;
		cout << "\n===================================" << endl;
	}
	else
	{
		cout << "\tEnter new name tovara: ";
		cin >> arr[index].name;
		cout << "\tEnter new firmy tovara: ";
		cin >> arr[index].firma;
		cout << "\tEnter new prise: ";
		cin >> arr[index].prise;
		cout << "\tEnter new id tovara: ";
		cin >> arr[index].id;
		cout << "\tItem changed successfully" << endl;
	}
}
template<typename T>
void task7(T*&arr,int length)
{
	
	char vibor [20];
	for (size_t i = 0; i < length; i++)
	{
		cout<< i+1<<")"<< arr[i].firma << endl;
	}
	cout << "\n===================================" << endl;
	cout << "\tEnter firm: " << endl;
	cin >> vibor;
	bool flag = false;
	
		for (size_t i = 0; i < length; i++)
		{
			if (strcmp(arr[i].firma,vibor) == 0)
			{
				cout <<"\n\tName: "<< arr[i].name << endl;
				cout <<"\tFirma: "<< arr[i].firma << endl;
				cout <<"\tPrise: "<< arr[i].prise << endl;
				cout <<"\tID: "<< arr[i].id << endl;
				cout << "\n===================================" << endl;

				flag = true;
			}
			
		}
		if (!flag)
		{
			cout << "\n===================================" << endl;
			cout << "\tnot found";
			cout << "\n===================================" << endl;
		}
	
}
template <typename T, typename T2>
void push(T*& arr, int& length, T2 obj)
{

	T* mas = new T[length + 1];
	for (size_t i = 0; i < length; i++)
	{
		mas[i] = arr[i];
	}
	mas[length] = obj;
	length++;
	delete[] arr;
	arr = mas;
}
template<typename T>
void task8(T*& arr,int length)//8)Вибірка : товари певного типу за ціною від X до Y
{
	char input[20];
	int from = 0;
	int to = 0;
	for (size_t i = 0; i < length; i++)
	{
		cout <<"1)"<< arr[i].name << endl;
	}
	cout << "Enter name cargo: ";
	cin >> input;
	cout << "Enter search from: ";
	cin >> from;
	cout << "Enter search to: ";
	cin >> to;
	bool flag = false;

	for (size_t i = 0; i < length; i++)
	{
		if (strcmp(arr[i].name, input) == 0 && arr[i].prise > from && arr[i].prise < to)
		{
			cout << "\n\tName: " << arr[i].name << endl;
			cout << "\tFirma: " << arr[i].firma << endl;
			cout << "\tPrise: " << arr[i].prise << endl;
			cout << "\tID: " << arr[i].id << endl;
			cout << "\n===================================" << endl;

			flag = true;
		}

	}
	if (!flag)
	{
		cout << "\n===================================" << endl;
		cout << "\tnot found";
		cout << "\n===================================" << endl;
	}

}
template <typename T>
void task9(T*& arr, int length, char* name)
{
	char obname[20];
	int sum = 0;
	int counter = 0;
	double allsum = 0;
	for (size_t i = 0; i < length; i++)
	{
		toLowerSTR(arr[i].name, obname);
		toLowerSTR(name, name);
		if (strcmp(obname, name) == 0 )
		{
			sum += arr[i].prise;
			counter++;
		}
	}
	allsum = (double)sum / counter;
	cout << "The average price of the product " << name << ": " << allsum << endl;
	cout << "===================================" << endl;
}
template<typename T>
void task11(T*& arr, int length)
{

	char vibor[20];
	for (size_t i = 0; i < length; i++)
	{
		cout << i + 1 << ")" << arr[i].name << endl;
	}
	cout << "\n===================================" << endl;
	cout << "\tEnter name: " << endl;
	cin >> vibor;
	bool flag = false;

	for (size_t i = 0; i < length; i++)
	{
		if (strcmp(arr[i].name, vibor) == 0)
		{
			cout << "\n\tName: " << arr[i].name << endl;
			cout << "\tFirma: " << arr[i].firma << endl;
			cout << "\tPrise: " << arr[i].prise << endl;
			cout << "\tID: " << arr[i].id << endl;
			cout << "\n===================================" << endl;

			flag = true;
		}

	}
	if (!flag)
	{
		cout << "\n===================================" << endl;
		cout << "\tnot found";
		cout << "\n===================================" << endl;
	}

}
int main()
{
	setlocale(LC_ALL, "");
	biz* mas_biz = new biz[0];
	biz obj;
	int newid = 0;
	int size = 0;
	int vibor = 0;
	int count = 0;
	int vib = 0;
	string path = "MyKyrsova.txt";
	fstream file;
	file.open("MyKyrsova.txt", fstream::app | fstream::in | fstream::out);
	if (!file.is_open()) {
		cout << "File not open or not found" << endl;
	}
	else
	{
		pr();
		cin >> vibor;
		switch (vibor)
		{
		case 1:
			cout << "\n___________________________________" << endl;
			cout << "\tHow much product you want to add: ";
			cin >> count;
			cout << "\n===================================" << endl;
			for (size_t i = 0; i < count; i++)
			{
				biz obj;
				addbiz(obj);
				file.write((char*)&obj, sizeof(biz));
			}
			break;
		case 2:
			while (file.read((char*)&obj, sizeof(biz)))
			{
				print(obj);
			}
			break;
		case 3:
			addbiz(obj);
			file.write((char*)&obj, sizeof(biz));
			break;

		case 4:
			while (file.read((char*)&obj, sizeof(biz)))
			{
				push(mas_biz, size, obj);
			}
			for (size_t i = 0; i < size; i++)
			{
				print(mas_biz[i]);
			}
			char n[20];
			int id;
			cout << "\n***********************************" << endl;
			cout << "\tWhat do you want to delete\n";
			cout << "\tEnter name: ";
			cin >> n;
			cout << "\tEnter id: ";
			cin >> id;
			delname(mas_biz, size, n, id);
			file.close();
			remove("MyKyrsova.txt");
			file.open("MyKyrsova.txt", fstream::app | fstream::in | fstream::out);
			if (!file.is_open())
			{
				cout << "Eror" << endl;
			}
			else
			{
				for (size_t i = 0; i < size; i++)
				{
					file.write((char*)&mas_biz[i], sizeof(biz));
				}
			}
			cout << "\n===================================" << endl;
			file.close();
			break;
		case 5:
			while (file.read((char*)&obj, sizeof(biz)))
			{
				push(mas_biz, size, obj);
			}
			for (size_t i = 0; i < size; i++)
			{
				print(mas_biz[i]);
			}
			updatetovar(mas_biz, size);
			file.close();
			remove("MyKyrsova.txt");
			file.open("MyKyrsova.txt", fstream::app | fstream::in | fstream::out);
			if (!file.is_open())
			{
				cout << "Eror" << endl;
			}
			else
			{
				for (size_t i = 0; i < size; i++)
				{
					file.write((char*)&mas_biz[i], sizeof(biz));
				}
			}
			file.close();
			break;
		case 6:
			while (file.read((char*)&obj, sizeof(biz)))
			{
				push(mas_biz, size, obj);
			}
			cout << "\n===================================" << endl;
			cout << "\t1)Enter sort by name ";
			cout << "\t1)Enter sort by namber ";
			cin >> vib;
			if (vib == 1)
			{
				sortName(mas_biz, size);
			}
			else if (vib == 2)
			{
				sortPrise(mas_biz, size);
			}
			else
			{
				cout << "\t<<Erorr>>" << endl;
			}
			file.close();
			break;
		case 7:
			while (file.read((char*)&obj, sizeof(biz)))
			{
				push(mas_biz, size, obj);
			}
			task7(mas_biz, size);
			file.close();
			break;
		case 8:
			while (file.read((char*)&obj,sizeof(biz)))
			{
				push(mas_biz, size, obj);
			}
			task8(mas_biz, size);
			file.close();
			break;
		case 9:
			while (file.read((char*)&obj, sizeof(biz)))
			{
				push(mas_biz, size, obj);
			}
			char name[20];
			
			cout << "\n===================================" << endl;
			cout << "\tEnter name: ";
			cin >> name;
			task9(mas_biz, size, name);
			file.close();
			break;
		case 10:
			while (file.read((char*)&obj, sizeof(biz)))
			{
				push(mas_biz, size, obj);
			}
			int vibor ;
			cout << "\n===================================" << endl;
			cout << "\tEnter options" << endl;
			cout << "\t1)Delete goods\n\t2)Product change" << endl;
			cin >> vibor;
			//delete goods
			if (vibor == 1)
			{
				char n[20];
				int id;
				cout << "What do you want to delete\n";
				cout << "Enter name: ";
				cin >> n;
				cout << "Enter id: ";
				cin >> id;
				delname(mas_biz, size, n, id);
				file.close();
				remove("MyKyrsova.txt");
				file.open("MyKyrsova.txt", fstream::app | fstream::in | fstream::out);
				if (!file.is_open())
				{
					cout << "Eror" << endl;
				}
				else
				{
					for (size_t i = 0; i < size; i++)
					{
						file.write((char*)&mas_biz[i], sizeof(biz));
					}
				}
				file.close();
			}

			//product change
			else if(vibor == 2)
			{
				for (size_t i = 0; i < size; i++)
				{
					print(mas_biz[i]);
				}
				updatetovar(mas_biz, size);
				file.close();
				remove("MyKyrsova.txt");
				file.open("MyKyrsova.txt", fstream::app | fstream::in | fstream::out);
				if (!file.is_open())
				{
					cout << "Eror" << endl;
				}
				else
				{
					for (size_t i = 0; i < size; i++)
					{
						file.write((char*)&mas_biz[i], sizeof(biz));
					}
				}
				file.close();
			}
			else
			{
				cout << "\tError options" << endl;
			}
			file.close();
			break;
			
		case 11: 
			while (file.read((char*)&obj, sizeof(biz)))
			{
				push(mas_biz, size, obj);
			}
			task11(mas_biz, size);

			file.close();
			break;
		
			
		}

	}


}